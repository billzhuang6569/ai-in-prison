# 历史会话管理面板使用指南

## 概述

历史会话管理面板是Project Prometheus的新功能，允许用户查看、管理和下载所有历史实验会话的数据。该面板提供了强大的过滤、排序和批量下载功能。

## 访问方式

点击Header（页面顶部）右侧的 **"📚 历史会话"** 按钮，即可打开历史会话管理面板的模态窗口。

## 主要功能

### 1. 会话列表显示

面板以表格形式显示所有历史会话，包含以下信息：

| 列名 | 描述 |
|------|------|
| **选择** | 复选框，用于批量操作 |
| **会话ID** | 唯一的会话标识符，格式：session_YYYYMMDD_HHMMSS_xxxx |
| **开始时间** | 实验开始的具体时间 |
| **持续时间** | 实验运行的总时长 |
| **事件数** | 该会话记录的总事件数量 |
| **Agent数** | 参与实验的AI智能体数量 |
| **天数** | 实验持续的游戏内天数 |
| **参与Agent** | 参与的Agent名称列表 |
| **操作** | 下载按钮组 |

### 2. 搜索和过滤

- **文本搜索**：在搜索框中输入关键词，可搜索会话ID或Agent名称
- **排序功能**：
  - 按开始时间排序（默认）
  - 按结束时间排序
  - 按事件数量排序
  - 按持续天数排序
- **排序方向**：点击"↑ 升序"/"↓ 降序"按钮切换排序方向

### 3. 单个会话下载

每个会话行都提供4种下载选项：

#### CSV 下载
- **格式**：CSV (Excel可打开)
- **内容**：完整事件记录 + AI决策数据（13列）
- **适用**：综合数据分析，包含所有事件和AI信息

#### JSON 下载  
- **格式**：JSON (机器可读)
- **内容**：结构化数据，包含完整AI信息
- **适用**：程序化分析，数据处理

#### AI 下载
- **格式**：CSV (专用AI分析)
- **内容**：仅AI决策事件，含完整prompt和thinking（12列）
- **适用**：AI行为深度分析，研究决策模式

#### 摘要 下载
- **格式**：JSON
- **内容**：会话统计摘要和分析数据
- **适用**：快速了解会话概况

### 4. 批量操作

#### 选择会话
- **单选**：点击单个会话的复选框
- **全选**：点击"全选"按钮选择当前筛选结果中的所有会话
- **清空**：点击"清空"按钮取消所有选择

#### 批量下载
- **批量下载CSV**：下载所有选中会话的CSV数据
- **批量下载AI数据**：下载所有选中会话的AI决策数据
- 系统会自动为每个会话生成单独的文件，文件间有500ms间隔

### 5. 状态指示

- **选择计数**：显示"选中 X / Y 个会话"
- **总体统计**：底部显示总会话数、显示数量和总事件数
- **下载状态**：下载进行中时显示"下载中..."提示
- **加载状态**：数据加载时显示"🔄 加载会话数据中..."

## 使用场景

### 1. 研究项目管理
- 查看所有历史实验的概况
- 比较不同时期的实验结果
- 按时间或规模筛选感兴趣的实验

### 2. 数据分析准备
- 批量下载多个会话的数据进行对比分析
- 获取特定类型的数据（如仅AI决策数据）
- 导出摘要数据进行元分析

### 3. 实验档案管理
- 按关键词搜索特定实验
- 查看实验的基本信息和参与者
- 管理和整理历史数据

### 4. 质量控制
- 识别异常短或长的实验会话
- 查看事件数量异常的会话
- 验证数据完整性

## 文件命名规则

下载的文件遵循以下命名规则：

- **标准CSV**：`prometheus_events_enhanced_{session_id}.csv`
- **AI决策数据**：`prometheus_ai_decisions_{session_id}.csv`
- **JSON数据**：`prometheus_events_enhanced_{session_id}.json`
- **会话摘要**：`{session_id}_summary.json`

## 技术特性

### 性能优化
- **虚拟滚动**：大量数据时保持流畅滚动
- **分页加载**：避免一次性加载过多数据
- **异步下载**：不阻塞用户界面操作

### 用户体验
- **响应式设计**：适配不同屏幕尺寸
- **实时搜索**：输入即时过滤结果
- **状态反馈**：清晰的加载和错误提示
- **键盘支持**：支持常用键盘快捷操作

### 数据安全
- **客户端处理**：所有过滤和排序在本地进行
- **安全下载**：通过HTTPS安全传输数据
- **会话隔离**：每个会话的数据完全独立

## 故障排除

### 常见问题

**Q: 看不到任何会话数据**
A: 确保后端服务正在运行，且数据库中有历史数据

**Q: 下载失败**
A: 检查网络连接和后端服务状态，某些浏览器可能阻止下载

**Q: 搜索没有结果**
A: 确认搜索关键词拼写正确，或尝试清空搜索框查看所有数据

**Q: 页面卡顿**
A: 如果会话数量很多，使用搜索功能减少显示的数据量

### 错误处理
- 网络错误会显示具体错误信息
- 下载失败会弹出错误提示
- 数据加载失败会显示重试按钮

## 最佳实践

1. **定期导出数据**：避免数据库过大影响性能
2. **使用搜索功能**：在大量会话中快速定位目标
3. **批量下载**：一次性获取多个相关会话的数据
4. **选择合适格式**：根据分析需求选择CSV、JSON或AI专用格式
5. **注意文件大小**：大型会话的数据文件可能很大，确保磁盘空间充足

通过历史会话管理面板，研究人员可以高效地管理和分析Project Prometheus生成的大量实验数据，为AI行为研究提供强有力的数据支持。